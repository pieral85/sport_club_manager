<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <record id="cron_interclub_event_states_update" model="ir.cron">
        <field name="name">Update Events State</field>
        <field name="model_id" ref="model_interclub_event"/>
        <field name="state">code</field>
        <field name="code">model.update_states(auto_mail=True)</field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="numbercall">-1</field>
        <field name="doall" eval="False"/>
        <field name="nextcall" eval="(DateTime.now() + relativedelta(days=1)).strftime('%Y-%m-%d 01:30:00')"/>
    </record>

    <!--Email template for Membership Affiliation Confirmation-->
    <record id="email_template_interclub_event_opening" model="mail.template">
        <field name="name">Interclub Event Opening</field>
        <field name="model_id" ref="model_interclub_event"/>
        <field name="email_from"><![CDATA[
"${user.company_id.name|safe}" <${(user.company_id.email or user.email)|safe}>
]]>
        </field>
        <field name="subject">Registrations opening for interclub event ${object.name}</field>
        <!-- TODO? <field name="partner_to">${object.contact_person_id and object.contact_person_id.email and object.contact_person_id.id or object.member_id and object.member_id.email and object.member_id.id}</field> -->
        <field name="auto_delete" eval="False"/>
        <!-- <field name="lang">${object.member_id.lang}</field> -->
        <field name="body_html"><![CDATA[
<div>
    % set colors = {'needsAction': 'grey', 'accepted': 'green', 'tentative': '#FFFF00',  'declined': 'red'}
    <p>
object.partner_id.name 
        Hello ${object.name},<br/><br/>
        This is a reminder for the below event :
    </p>
    <table border="0" cellpadding="0" cellspacing="0"><tr>
        <td width="130px;">
            <div style="border-top-left-radius: 3px; border-top-right-radius: 3px; font-size: 12px; border-collapse: separate; text-align: center; font-weight: bold; color: #ffffff; min-height: 18px; background-color: #875A7B; border: 1px solid #875A7B;">
                ${object.event_id.get_interval('dayname', tz=object.partner_id.tz if not object.event_id.allday else None)}
            </div>
            <div style="font-size: 48px; min-height: auto; font-weight: bold; text-align: center; color: #5F5F5F; background-color: #F8F8F8; border: 1px solid #875A7B;">
                ${object.event_id.get_interval('day', tz=object.partner_id.tz if not object.event_id.allday else None)}
            </div>
            <div style='font-size: 12px; text-align: center; font-weight: bold; color: #ffffff; background-color: #875A7B;'>
                ${object.event_id.get_interval('month', tz=object.partner_id.tz if not object.event_id.allday else None)}
            </div>
            <div style="border-collapse: separate; color: #5F5F5F; text-align: center; font-size: 12px; border-bottom-right-radius: 3px; font-weight: bold; border: 1px solid #875A7B; border-bottom-left-radius: 3px;">
                ${not object.event_id.allday and object.event_id.get_interval('time', tz=object.partner_id.tz) or ''}
            </div>
        </td>
        <td width="20px;"/>
        <td style="padding-top: 5px;">
            <p><strong>Details of the event</strong></p>
            <ul>
                % if object.event_id.location:
                    <li>Location: ${object.event_id.location}
                        (<a target="_blank" href="http://maps.google.com/maps?oi=map&amp;q=${object.event_id.location}">View Map</a>)
                    </li>
                % endif
                % if object.event_id.description :
                    <li>Description: ${object.event_id.description}</li>
                % endif
                % if not object.event_id.allday and object.event_id.duration
                    <li>Duration: ${('%dH%02d' % (object.event_id.duration,(object.event_id.duration*60)%60))}</li>
                % endif
                <li>Attendees
                <ul>
                % for attendee in object.event_id.attendee_ids:
                    <li>
                        <div style="display: inline-block; border-radius: 50%; width: 10px; height: 10px; background:${colors[attendee.state] or 'white'};"> </div>
                        % if attendee.common_name != object.common_name:
                            <span style="margin-left:5px">${attendee.common_name}</span>
                        % else:
                            <span style="margin-left:5px">You</span>
                        % endif
                    </li>
                % endfor
                </ul></li>
            </ul>
        </td>
    </tr></table>
    <br/>
    Thank you,
    <br/>
    % if object.event_id.user_id and object.event_id.user_id.signature:
        ${object.event_id.user_id.signature | safe}
    % endif
</div>
]]>
        </field>
    </record>
</data>
</odoo>
